@(documents: Seq[(Option[String], Seq[GDocIndexEntry])], collections: Seq[(String, Int)], currentCollection: String, user: models.User)

@import tags.lang

<html>
  <head>
    <title>RECOGITO</title>
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/index/main.css")" />
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/jquery/jquery-2.0.0.min.js")"></script>
    <script type="text/javascript">
      function toggleVersions(id) {
        var toggleIcon = $('.plus-' + id),
          headerRow = $('.lang-group-header.lang-group-' + id),
          versionRows = $('.lang-group.lang-group-' + id),
          display = versionRows.css('display');

        toggleIcon.toggleClass('less');
        headerRow.toggleClass('open');
        if (display == 'none') {
          versionRows.css('display', 'table-row');
        } else {
          versionRows.css('display', 'none');
        }
      }
    </script>
  </head>
  
  <body>
    <div id="header">
      <div id="header-top">
        <div id="title">
          <h1>Recogito</h1>
          <div id="current-user">
            <div id="info">
              logged in as: <strong>@user.username</strong>
              <p id="user-links">
                @if(user.isAdmin) { <a href="@controllers.admin.routes.DocumentAdminController.listAll" title="Administration Access to Recogito">Administration</a> }
                <a href="@routes.UserController.changePassword" title="Edit User Settings">My Settings</a>
              </p>
            </div> 
            
            <div id="logout"> 
              <a href="@routes.AuthController.logout" title="Logout"><span class="icon">&#xf011;</span></a>
            </div>
          </div>
        </div>
      </div>
      
      <div id="column-headings">
        <table>
          <thead>
            <tr>
              <th class="title">Document</th>
              <th class="center">Toponyms</th>
              <th class="center">Complete</th>
              <th class="actions"></th>    
            </tr>
          </thead>
        </table>
      </div>
    </div>
    
    <div id="container">    
      <div id="collections-sidebar">
        <h2>Collections</h2>
        <ul>
          @for(collection <- collections) {
          	@if(currentCollection.equalsIgnoreCase(collection._1)) { <li> } else { <li class="disabled"> }
              <a href="@routes.ApplicationController.index(Some(collection._1.toLowerCase))">
                <span class="collection-name">@collection._1</span>
                <span class="collection-count">@collection._2</span>
              </a>
            </li>
          }
        </ul>  
      </div>
      
      @singleDoc(entry: GDocIndexEntry, langGroup: Option[Int] = None) = {
        @if(langGroup.isDefined) { <tr class="lang-group lang-group-@langGroup.get"> } else { <tr> }
          <td class="title"> <!-- document title -->
            <div> <!-- We need this DIV for the CSS ellipsis truncation to work! -->
              @entry.doc.author.map(_ + ": ").getOrElse("") @entry.doc.title
              @entry.doc.dateComment.map("(" + _ + ")").getOrElse("")
            </div> 
          </td>
          
          <!-- # of parts -->
          <td class="center"></td>

          <!-- languages -->                
          <td class="center">@lang(entry.doc.language)</td>
                
          <!-- # of toponyms -->
          <td class="center">@entry.total</td>     
               
          <!-- completion ratio --> 
          <td class="stats" title="@{ "%.2f" format (entry.percentComplete * 100) } % Complete">
            <div class="meter">
              <span class="yellow" style="width: @{(entry.percentVerified + entry.percentUnidentifiable) * 100}%"></span>
              <span class="green@if(entry.percentUnidentifiable == 0) { full}" style="width: @{entry.percentVerified * 100}%"></span>
            </div>
          </td>
          
          <!-- shortcut icons -->
          <td>
            <!-- document stats short -->
            <a href="@routes.ApplicationController.showDocumentStats(entry.doc.id.get)" class="icon" title="Detailed Stats">&#xf080;</a>
            
            <!-- text shortcut -->
            @if(entry.texts.size > 0) {
              <a class="icon" href="@routes.ApplicationController.showTextAnnotationUI(Some(entry.texts.head), None)" title="Text Annotation">&#xf0f6;</a>
            } else {
              <span class="icon disabled">&#xf0f6;</span>
            }
            
            <!-- georesolution shortcut -->
            <a class="icon" href="@routes.ApplicationController.showGeoResolutionUI(entry.doc.id.get)" title="Geo-Resolution">&#xf0ac;</a>
            
            <!-- CSV download shortcut -->
            <a class="icon" href="@routes.DocumentController.get(entry.doc.id.get, Some("csv"))" title="Download CSV">&#xf0ce;</a>
          </td>
        </tr>      	
      }
      
      @languageGroup(entries: Seq[GDocIndexEntry]) = {
        <tr class="lang-group-header lang-group-@entries.head.doc.id.get" onclick="toggleVersions(@entries.head.doc.id.get); return false;">
          <td class="title"> <!-- document title -->
            <div> <!-- We need this DIV for the CSS ellipsis truncation to work! -->
              <span class="icon plus plus-@entries.head.doc.id.get"></span>
              @entries.head.doc.author.map(_ + ": ").getOrElse("") @entries.head.doc.title
              @entries.head.doc.dateComment.map("(" + _ + ")").getOrElse("")
            </div>
          </td>
          
          <!-- # of versions -->
          <td class="versions center">@entries.size Versions</td>

          <!-- languages -->                
          <td></td>
                
          <!-- # of toponyms -->
          @defining((entries.map(_.total).min, entries.map(_.total).max)) { toponyms =>
            <td class="center">
              @if(toponyms._1 == toponyms._2) {
                @toponyms._1	
              } else {
                @toponyms._1 - @toponyms._2
              }
            </td>
          }     
          
          <!-- completion ratio -->
          @defining(entries.map(_.percentComplete * 100).foldLeft(0.0)(_ + _) / entries.size) { completionRatio =>
            <td class="stats" title="@{ "%.2f" format (completionRatio) } % Complete">
              <div class="meter">
                <span class="yellow" style="width: 95%"></span>
                <span class="green" style="width: @completionRatio%"></span>
              </div>
            </td>
          }         
          
          <!-- shortcut icons -->
          <td></td>
        </tr>  
        
        <!-- individual language entries -->
        @for(entry <- entries) {
          @singleDoc(entry, entries.head.doc.id)
        }         	
      }
      
      <div id="document-list">
        <table class="index"> 
          <tbody>
            @for((extWorkId, docs) <- documents) {
              @if(docs.size > 1) {
                @languageGroup(docs)
              } else {
                @singleDoc(docs.head)
              }
            }
          </tbody> 
        </table>
      </div>
      
    </div>
  </body>
</html>
