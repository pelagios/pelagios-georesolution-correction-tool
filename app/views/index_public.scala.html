@(documents: Seq[(Option[String], Seq[GDocIndexEntry])], collections: Seq[(String, Int)], currentCollection: String)(implicit request: RequestHeader)

@import tags.lang

<html>
  <head>
    <title>RECOGITO</title>
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/index/main.css")" />
    <script type="text/javascript" src="@routes.Assets.at("javascripts/lib/jquery/jquery-1.11.1.min.js")"></script>
    <script type="text/javascript">
      function toggleVersions(id) {
        var toggleIcon = $('.plus-' + id),
          headerRow = $('.lang-group-header.lang-group-' + id),
          versionRows = $('.lang-group.lang-group-' + id),
          display = versionRows.css('display');

        toggleIcon.toggleClass('less');
        headerRow.toggleClass('open');
        if (display == 'none') {
          versionRows.css('display', 'table-row');
        } else {
          versionRows.css('display', 'none');
        }
      }
    </script>
  </head>
  
  <body>
    @tags.browser_warning()
    <div id="header">
      <div id="header-top">
        <div id="title">
          <h1>Recogito</h1>
          <div id="login">
            <a class="button blue" href="@routes.AuthController.login(None)">Log In <span class="icon">&#xf090;</span></a>
          </div>
        </div>
      </div>
      
      <div id="column-headings">
        <table>
          <thead>
            <tr>
              <th class="title">Document</th>
              <th class="center">Toponyms</th>
              <th class="center">Complete</th>
              <th class="actions"></th>       
            </tr>
          </thead>
        </table>
      </div>
    </div>
    
    <div id="container">  
      <div id="collections-sidebar">
        <h2>Collections</h2>
        <ul>
          @for(collection <- collections) {
          	@if(currentCollection.equalsIgnoreCase(collection._1)) { <li> } else { <li class="disabled"> }
              <a href="@routes.ApplicationController.index(Some(collection._1.toLowerCase))">
                <span class="collection-name">@collection._1</span>
                <span class="collection-count">@collection._2</span>
              </a>
            </li>
          }
        </ul>  
      </div>
      
      @singleDoc(entry: GDocIndexEntry, langGroup: Option[Int] = None) = {
        @if(langGroup.isDefined) { <tr class="lang-group lang-group-@langGroup.get"> } else { <tr> }
          <td class="title" colspan="2"> <!-- document title (and # of versions) -->
            <div> <!-- We need this DIV for the CSS ellipsis truncation to work! -->
              @entry.doc.author.map(_ + ": ").getOrElse("") @entry.doc.title
              @entry.doc.dateComment.map("(" + _ + ")").getOrElse("")
            </div> 
          </td>

          <!-- languages -->                
          <td class="center">@lang(entry.doc.language)</td>
                
          <!-- # of toponyms -->
          <td class="center">@entry.total</td>     
               
          <!-- completion ratio --> 
          <td class="stats" title="@{ "%.2f" format (entry.percentComplete * 100) } % Complete">
            <div class="meter">
              <span class="yellow" style="width: @{(entry.percentVerified + entry.percentUnidentifiable) * 100}%"></span>
              <span class="green@if(entry.percentUnidentifiable == 0) { full}" style="width: @{entry.percentVerified * 100}%"></span>
            </div>
          </td>
          
          <!-- icons -->
          <td>
            <a class="icon" href="@routes.ApplicationController.showMap(entry.doc.id.get)" title="Public Map">&#xf0ac;</a>
            <a class="icon" href="@routes.DocumentController.get(entry.doc.id.get, Some("csv"))" title="Download CSV">&#xf0ce;</a>
          </td>
        </tr>      	
      }
      
      @languageGroup(entries: Seq[GDocIndexEntry]) = {
        <tr class="lang-group-header lang-group-@entries.head.doc.id.get" onclick="toggleVersions(@entries.head.doc.id.get); return false;">
          <td class="title"> <!-- document title -->
            <div> <!-- We need this DIV for the CSS ellipsis truncation to work! -->
              <span class="icon plus plus-@entries.head.doc.id.get"></span>
              @entries.head.doc.author.map(_ + ": ").getOrElse("") @entries.head.doc.title
              @entries.head.doc.dateComment.map("(" + _ + ")").getOrElse("")
            </div>
          </td>
          
          <!-- # of versions -->
          <td class="versions">@entries.size Versions</td>

          <!-- languages -->                
          <td></td>
                
          <!-- # of toponyms -->
          @defining((entries.map(_.total).min, entries.map(_.total).max)) { toponyms =>
            <td class="center">
              @if(toponyms._1 == toponyms._2) {
                @toponyms._1	
              } else {
                @toponyms._1 - @toponyms._2
              }
            </td>
          }     
          
          <!-- completion ratio -->
          @defining(entries.map(_.percentComplete).foldLeft(0.0)(_ + _) / entries.size) { percentComplete =>
            @defining(entries.map(_.percentVerified).foldLeft(0.0)(_ + _) / entries.size) { percentVerified =>
              <td class="stats" title="@{ "%.2f" format (percentComplete * 100)} % Complete">
                <div class="meter">
                  <span class="yellow" style="width: @{percentComplete * 100}%"></span>
                  <span class="green@if(percentComplete == percentVerified) { full}" style="width: @{percentVerified * 100}%"></span>
                </div>
              </td>
            }         
          }                 
          
          <!-- icons -->
          <td></td>
        </tr>  
        
        <!-- individual language entries -->
        @for(entry <- entries) {
          @singleDoc(entry, Some(entries.head.doc.id.get))
        }         	
      }
      
      <div id="document-list">
        <div id="total-progress">
          <div class="label">
            @{ documents.flatMap(_._2).foldLeft(0)((total, entry) => total + entry.total) } Toponyms Total
          </div>
          @defining(documents.flatMap(_._2).filter(e => !(e.percentComplete.isNaN() || e.percentVerified.isNaN()))) { entries =>
          	@defining(entries.map(_.percentComplete).foldLeft(0.0)(_ + _) / entries.size) { percentComplete =>
          	  @defining(entries.map(_.percentVerified).foldLeft(0.0)(_ + _) / entries.size) { percentVerified =>
                <div class="meter" title="@{ "%.2f" format (percentComplete * 100)} % Complete">
                  <span class="yellow" style="width:@{percentComplete * 100}%"></span>
                  <span class="green@if(percentComplete == percentVerified) { full}" style="width: @{percentVerified * 100}%"></span>
                </div>
              }
            }
          }
        </div>
                
        <table class="index"> 
          <tbody>
            @for((extWorkId, docs) <- documents) {
              @if(docs.size > 1) {
                @languageGroup(docs)
              } else {
                @singleDoc(docs.head)
              }
            }
          </tbody> 
        </table>
      </div>
    </div>
  </body>
</html>
